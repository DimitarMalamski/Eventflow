@using Eventflow.Domain.Models.ViewModels
@model CreatePersonalEventTextareaModel

@{
    var name = Model?.Name ?? "";
    var value = "";
    var error = "";
    var showError = false;

    if (!string.IsNullOrEmpty(name) && ViewContext.ViewData.Model != null)
    {
        value = ViewContext.ViewData.Model.GetType()
            .GetProperty(name)?
            .GetValue(ViewContext.ViewData.Model)?
            .ToString() ?? "";

        if (ViewContext.ViewData.ModelState.TryGetValue(name, out var state))
        {
            showError = state.Errors.Any() && state.RawValue != null;
            error = showError ? state.Errors.First().ErrorMessage : "";
        }
    }
}

<div class="mb-3">
    <label for="@name" class="form-label">@Model!.Label</label>
    <textarea id="@name"
              name="@name"
              class="form-control @(showError ? "is-invalid" : "")"
              rows="4"
              placeholder="@Model.Placeholder">@value</textarea>

    @if (showError)
    {
        <span class="text-danger">@error</span>
    }
</div>
