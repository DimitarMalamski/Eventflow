@using Eventflow.Domain.Models.ViewModels
@model FormInputModel

@{
    var name = Model?.Name ?? "";
    var value = Model?.Value ?? "";
    var error = "";
    bool showError = false;

    if (string.IsNullOrEmpty(value) && !string.IsNullOrEmpty(name) && ViewContext.ViewData.Model != null)
    {
        value = ViewContext.ViewData.Model.GetType()
            .GetProperty(name)?
            .GetValue(ViewContext.ViewData.Model)?
            .ToString() ?? "";
    }

    if (!string.IsNullOrEmpty(name) && ViewContext.ViewData.ModelState.TryGetValue(name, out var state))
    {
        showError = state.Errors.Any() && state.RawValue != null;
        error = showError ? state.Errors.First().ErrorMessage : "";
    }
}

<div class="mb-3">
    <label for="@name" class="form-label">@Model!.Label</label>
    <input type="@Model.Type"
           id="@name"
           name="@name"
           value="@value"
           class="form-control @(showError ? "is-invalid" : "")"
           placeholder="@Model.Placeholder" />

    @if (!string.IsNullOrEmpty(error))
    {
        <span class="text-danger">@error</span>
    }
</div>